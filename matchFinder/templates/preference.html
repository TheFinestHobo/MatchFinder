{% extends "layout.html" %}

{% block title %}Prioritäten setzen{% endblock %}

{% block header %}Prioritäten setzen{% endblock %}

{% block body %}
<div id="app">
	<h5>Hallo {{teilnehmer.first_name}}, bitte gebe deine Präferenzen an!</h5>
	<form method=post action="{{ url_for('preference.save') }}" enctype=multipart/form-data>
		<div class="col-lg-8 col-md-10 col-sm-12 col-xs-12">
			{% for thema in themen %}
			<div class="input-group mb-2">
				<div class="input-group-prepend w-25">
					<span class="input-group-text w-100">{{thema.thema_name}}</span>
				</div>
				<select @change="onChange($event)" class="form-control custom-select mr-sm-2" tag="selector" name="{{loop.index}}" id="{{loop.index}}">
					<option v-for="(item, index) in validOptions({{loop.index}})">
						${item}
					</option>
				</select>
			</div>
			{% endfor %}
			<input class="btn btn-primary" type="submit" value="Submit">
			<input type="hidden" id="information" name="information" value='{"teilnehmer_id": "{{teilnehmer.id}}","verteilung_id":"{{verteilung_id}}"}'>
		</div>
	</form>
</div>

{% endblock %}

{% block scripts %}

<script type="text/javascript" src="{{ url_for('static', filename='vue.js') }}"></script>
<script type="text/javascript">


	var app = new Vue({
		el: "#app",
		delimiters: ['${', '}'],
		data: {

			options : [
			"Keine Präferenz",
			"Erstwahl",
			"Zweitwahl",
			"Drittwahl",
			"Viertwahl",
			"Fünftwahl",
			"Sechstwahl",
			"Siebtwahl",
			"Achtwahl",
			"Neuntwahl",
			"Zehntwahl",
			"Veto",
			],

			mapping: {
				"Keine Präferenz" : "",
				"Erstwahl" : "",
				"Zweitwahl" : "",
				"Drittwahl" : "",
				"Viertwahl" : "",
				"Fünftwahl" : "",
				"Sechstwahl" : "",
				"Siebtwahl" : "",
				"Achtwahl" : "",
				"Neuntwahl" : "",
				"Zehntwahl" : "",
				"Veto" : "",
			}
		},
		methods: {
			validOptions(object) {
				return this.options.filter(
					f => this.mapping[f] == "" || this.mapping[f] == object
					)
			},
			onChange(event) {
				const value = event.target.value
				const target = event.target
				if (value != this.options[0]) {
					for (var key in this.mapping) {
						if (this.mapping[key] == target.id) {
							this.mapping[key] = ""
						}
					}

					for (var key in this.mapping) {
						if (key == value) {
							this.mapping[key] = target.id
						}
					}

				} else {
					for (var key in this.mapping) {
						if (this.mapping[key] == target.id) {
							this.mapping[key] = ""
						}
					}
				}


				for (i = 1; i <= {{themen | length}}; i++) {

					const element = document.getElementById(i)
					var index = 0
					var selected = ""
					for (var key in this.mapping) {
						if (this.mapping[key] == element.id) {
							selected = key
							break
						}
						if (this.mapping[key] == "") { index++ }
					}
				if (element.selected != this.options[0] && index < element.options.length) {
					element.options[index].selected = true
				}
			}
		}
	}
})

</script>
{% endblock %}